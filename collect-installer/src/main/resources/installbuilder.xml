<project>
	<shortName>OpenForisCollect</shortName>
	<fullName>Open Foris Collect</fullName>
	<version>VERSION_ID</version>
	<vendor>Open Foris</vendor>

	<!-- <readmeFile>../../../README</readmeFile> <licenseFile>../../../../License.txt</licenseFile> -->
	<logoImage>images/of-collect-logo-small.png</logoImage>
	<componentList>
		<component>
			<name>default</name>
			<description>Default Component</description>
			<canBeEdited>1</canBeEdited>
			<selected>1</selected>
			<show>1</show>
			<desktopShortcutList>
				<shortcut>
					<name>Start Open Foris Collect</name>
					<comment>Start Open Foris Collect</comment>
					<exec>${installdir}/start.sh</exec>
					<path>${installdir}</path>
					<icon>${installdir}/images/of-collect-logo.png</icon>
					<platforms>linux</platforms>
					<runAsAdmin>0</runAsAdmin>
					<runInTerminal>0</runInTerminal>
					<windowsExec></windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon></windowsIcon>
					<windowsPath></windowsPath>
				</shortcut>
				<shortcut>
					<name>Stop Open Foris Collect</name>
					<comment>Stop Open Foris Collect</comment>
					<exec>${installdir}/stop.sh</exec>
					<path>${installdir}</path>
					<icon>${installdir}/images/of-collect-logo.png</icon>
					<platforms>linux</platforms>
					<runAsAdmin>0</runAsAdmin>
					<runInTerminal>0</runInTerminal>
					<windowsExec></windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon></windowsIcon>
					<windowsPath></windowsPath>
				</shortcut>
				<shortcut>
					<name>Update Open Foris Collect</name>
					<comment>Update Open Foris Collect</comment>
					<exec>${installdir}/autoupdate/autoupdate-linux.run</exec>
					<path>${installdir}/autoupdate</path>
					<icon>${installdir}/images/update.png</icon>
					<platforms>linux</platforms>
					<runAsAdmin>0</runAsAdmin>
					<runInTerminal>0</runInTerminal>
					<windowsExec></windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon></windowsIcon>
					<windowsPath></windowsPath>
				</shortcut>
			</desktopShortcutList>
			<folderList>
				<folder>
					<name>programfiles</name>
					<description>Program Files</description>
					<destination>${installdir}</destination>
					<platforms>all</platforms>
					<distributionFileList>
						<distributionDirectory>
							<origin>collect-server/tomcat</origin>
						</distributionDirectory>
						<distributionFile>
							<allowWildcards>1</allowWildcards>
							<origin>images</origin>
						</distributionFile>
					</distributionFileList>
				</folder>
				<folder>
					<name>programfileslinux</name>
					<description>Linux Program Files</description>
					<destination>${installdir}</destination>
					<platforms>linux</platforms>
					<distributionFileList>
						<distributionFile>
							<origin>start.sh</origin>
						</distributionFile>
						<distributionFile>
							<origin>stop.sh</origin>
						</distributionFile>
					</distributionFileList>
				</folder>
				<folder>
					<name>programfileswindows</name>
					<description>Windows Program Files</description>
					<destination>${installdir}</destination>
					<platforms>windows</platforms>
					<distributionFileList>
						<distributionFile>
							<origin>start.bat</origin>
						</distributionFile>
						<distributionFile>
							<origin>stop.bat</origin>
						</distributionFile>
					</distributionFileList>
				</folder>
				<folder>
					<name>programfilesosx</name>
					<description>OSx Program Files</description>
					<destination>${installdir}</destination>
					<platforms>osx</platforms>
					<distributionFileList>
						<distributionFile>
							<origin>start.sh</origin>
						</distributionFile>
						<distributionFile>
							<origin>stop.sh</origin>
						</distributionFile>
					</distributionFileList>
				</folder>
			</folderList>
			<startMenuShortcutList>
				<startMenuShortcut>
					<name>Start Open Foris Collect</name>
					<comment>Start Open Foris Collect</comment>
					<runAsAdmin>0</runAsAdmin>
					<runInTerminal>0</runInTerminal>
					<windowsExec>${installdir}/start.bat</windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon>${installdir}/images/of-collect-logo.ico</windowsIcon>
					<windowsPath></windowsPath>
				</startMenuShortcut>
				<startMenuShortcut>
					<name>Stop Open Foris Collect</name>
					<comment>Stop Open Foris Collect</comment>
					<runAsAdmin>0</runAsAdmin>
					<runInTerminal>0</runInTerminal>
					<windowsExec>${installdir}/stop.bat</windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon>${installdir}/images/of-collect-logo.ico</windowsIcon>
					<windowsPath></windowsPath>
				</startMenuShortcut>
				<startMenuShortcut>
					<name>Update Open Foris Collect</name>
					<comment>Update Open Foris Collect</comment>
					<runAsAdmin>0</runAsAdmin>
					<runInTerminal>0</runInTerminal>
					<windowsExec>${installdir}/autoupdate/autoupdate-windows.exe</windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon>${installdir}/images/update.ico</windowsIcon>
				</startMenuShortcut>
			</startMenuShortcutList>
		</component>
		<component>
			<name>autoupdater</name>
			<description>includes tool to perform updates</description>
			<canBeEdited>0</canBeEdited>
			<selected>1</selected>
			<show>0</show>
			<folderList>
				<folder>
					<name>autoupdaterwin</name>
					<destination>${installdir}/autoupdate</destination>
					<platforms>windows</platforms>
					<distributionFileList>
						<distributionFile origin="autoupdate-windows.exe" />
					</distributionFileList>
				</folder>
				<folder>
					<name>autoupdaterlinux</name>
					<destination>${installdir}/autoupdate</destination>
					<platforms>linux</platforms>
					<distributionFileList>
						<distributionFile origin="autoupdate-linux.run" />
					</distributionFileList>
				</folder>
				<folder>
					<name>autoupdaterosx</name>
					<destination>${installdir}/autoupdate</destination>
					<platforms>osx</platforms>
					<distributionFileList>
						<distributionFile origin="autoupdate-osx.app.zip" />
					</distributionFileList>
				</folder>
			</folderList>
			<postInstallationActionList>
				<createDirectory>
					<path>${installdir}/autoupdate</path>
				</createDirectory>
				<writeFile>
					<path>${installdir}/autoupdate/update.ini</path>
					<text>[Update]
url = UPDATE_XML_URL
version_id = VERSION_ID
update_download_location = ${system_temp_directory}
check_for_updates = 1</text>
				</writeFile>
				<createDirectory>
					<path>${installdir}/data</path>
				</createDirectory>
				<getFreePort>
					<finalPort>8399</finalPort>
					<initialPort>8305</initialPort>
					<variable>tomcat_shutdown</variable>
		        </getFreePort>
		        <substitute>
		            <files>${installdir}/tomcat/conf/server.xml</files>
		            <type>exact</type>
		            <substitutionList>
		                <substitution>
		                    <pattern>8005</pattern>
		                    <value>${tomcat_shutdown}</value>
		                </substitution>
		            </substitutionList>
		        </substitute>
		        <getFreePort>
		            <finalPort>8399</finalPort>
		            <initialPort>8380</initialPort>
		            <variable>tomcat_http</variable>
		        </getFreePort>
		        <substitute>
		            <files>${installdir}/tomcat/conf/server.xml</files>
		            <type>exact</type>
		            <substitutionList>
		                <substitution>
		                    <pattern>8080</pattern>
		                    <value>${tomcat_http}</value>
		                </substitution>
		            </substitutionList>
		        </substitute>
		        <substitute>
		            <files>${installdir}/tomcat/collect.properties</files>
		            <type>exact</type>
		            <substitutionList>
		                <substitution>
		                    <pattern>{HTTP_PORT}</pattern>
		                    <value>${tomcat_http}</value>
		                </substitution>
		            </substitutionList>
		        </substitute>
		        <getFreePort>
		            <finalPort>8799</finalPort>
		            <initialPort>8743</initialPort>
		            <variable>tomcat_redirect</variable>
		        </getFreePort>
		        <substitute>
		            <files>${installdir}/tomcat/conf/server.xml</files>
		            <type>exact</type>
		            <substitutionList>
		                <substitution>
		                    <pattern>8443</pattern>
		                    <value>${tomcat_redirect}</value>
		                </substitution>
		            </substitutionList>
		        </substitute>
		        <getFreePort>
		            <finalPort>8399</finalPort>
		            <initialPort>8309</initialPort>
		            <variable>tomcat_ajp</variable>
		        </getFreePort>
		        <substitute>
		            <files>${installdir}/tomcat/conf/server.xml</files>
		            <type>exact</type>
		            <substitutionList>
		                <substitution>
		                    <pattern>8009</pattern>
		                    <value>${tomcat_ajp}</value>
		                </substitution>
		            </substitutionList>
		        </substitute>
		        <propertiesFileSet>
		        	<file>${installdir}/collect.properties</file>
		        	<key>tomcat_http_port</key>
		        	<value>${tomcat_http}</value>
		        </propertiesFileSet>
			</postInstallationActionList>
		</component>
		<include>
			<file>java.xml</file>
		</include>
	</componentList>
	<preInstallationActionList>
		<setInstallerVariable>
			<name>installdir</name>
			<value>${user_home_directory}/OpenForis/Collect</value>
		</setInstallerVariable>
		<throwError>
			<explanation>Open Foris Collect has been already installed</explanation>
			<text>Open Foris Collect has been already installed. Please run Update Open Foris Collect if you want to update it.</text>
			<ruleEvaluationLogic>and</ruleEvaluationLogic>
			<ruleList>
				<fileTest path="${installdir}" condition="exists" />
				<fileTest path="${installdir}" condition="is_not_empty" />
			</ruleList>
        </throwError>
	</preInstallationActionList>
	<postInstallationActionList>
		<substitute>
			<files>${installdir}/start.sh;${installdir}/stop.sh;${installdir}/start.bat;${installdir}/stop.bat;</files>
			<type>exact</type>
			<substitutionList>
				<substitution>
					<pattern>install_directory</pattern>
					<value>${installdir}</value>
				</substitution>
			</substitutionList>
		</substitute>
        <substitute>
            <files>${installdir}/start.sh;${installdir}/start.bat;</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>{TOMCAT_HTTP_PORT}</pattern>
                    <value>${tomcat_http}</value>
                </substitution>
            </substitutionList>
        </substitute>
   		<changePermissions>
			<files>${installdir}/*.sh</files>
			<permissions>0775</permissions>
		</changePermissions>
		<changePermissions>
			<files>${installdir}/autoupdate/*.run</files>
			<permissions>0775</permissions>
		</changePermissions>
		<changeOwnerAndGroup>
			<files>/home/${env(SUDO_USER)}/Desktop/${java_launcher_binary_name}
			</files>
			<group></group>
			<owner>${env(SUDO_USER)}</owner>
			<ruleList>
				<platformTest>
					<type>linux</type>
				</platformTest>
			</ruleList>
		</changeOwnerAndGroup>
		<!-- delete temporary files (if any, from previous installations) -->
        <deleteFile>
  			<path>${installdir}/tomcat/webapps/collect</path>
			<abortOnError>0</abortOnError>
		</deleteFile>
		<createJavaLaunchers>
		    <javaLauncherList>
		    </javaLauncherList>
		</createJavaLaunchers>
	</postInstallationActionList>
	<postUninstallationActionList>
		<deleteFile>
			<path>${installdir}</path>
		</deleteFile>
		<deleteFile>
			<path>${project.rollbackBackupDirectory}</path>
		</deleteFile>
	</postUninstallationActionList>
	<compressionAlgorithm>lzma-ultra</compressionAlgorithm>
	<defaultUnixDirectoryPermissions>777</defaultUnixDirectoryPermissions>
	<defaultUnixFilePermissions>777</defaultUnixFilePermissions>
	<defaultUnixOwner>${env(SUDO_USER)}</defaultUnixOwner>
	<enableRollback>1</enableRollback>
	<enableTimestamp>1</enableTimestamp>
	<rebootRequired>0</rebootRequired>
	<requireInstallationByRootUser>0</requireInstallationByRootUser>
	<requestedExecutionLevel>asInvoker</requestedExecutionLevel>
	<rollbackBackupDirectory>${system_temp_directory}/${product_shortname}/backup</rollbackBackupDirectory>
	<saveRelativePaths>1</saveRelativePaths>
	<createOsxBundleDmg>1</createOsxBundleDmg>
	<parameterList>
		<directoryParameter>
			<name>installdir</name>
			<description>Installer.Parameter.installdir.description</description>
			<explanation>Installer.Parameter.installdir.explanation</explanation>
			<value></value>
			<default>${platform_install_prefix}/${product_shortname}</default>
			<allowEmptyValue>0</allowEmptyValue>
			<cliOptionName>prefix</cliOptionName>
			<mustBeWritable>1</mustBeWritable>
			<mustExist>0</mustExist>
			<width>30</width>
		</directoryParameter>
	</parameterList>
</project>

